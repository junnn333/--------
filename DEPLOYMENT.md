# Cloudflare Pages デプロイガイド

## 前提条件

- GitHubアカウント
- Cloudflareアカウント
- このリポジトリがGitHubにプッシュされていること

## デプロイ手順

### 1. Cloudflare Pages でプロジェクト作成

1. [Cloudflare Pages](https://pages.cloudflare.com/) にアクセス
2. 「プロジェクト作成」をクリック
3. 「GitHubに接続」を選択
4. GitHubで権限を許可

### 2. リポジトリ選択

1. このポートフォリオリポジトリを選択
2. 「セットアップの開始」をクリック

### 3. ビルド設定

以下の設定を確認（または入力）：

| 項目 | 値 |
|------|-----|
| **フレームワークプリセット** | なし |
| **ビルドコマンド** | （空白） |
| **ビルド出力ディレクトリ** | `/` |

### 4. 環境変数の設定 ⭐️ **重要**

1. デプロイ前に「環境変数」セクションを展開
2. 以下を追加：

**Production環境:**
- **変数名**: `PORTFOLIO_PASSWORD`
- **値**: あなたの希望するパスワード

**Preview環境:**（オプション）
- **変数名**: `PORTFOLIO_PASSWORD`
- **値**: テスト用パスワード

### 5. デプロイ実行

「保存してデプロイ」をクリック

### 6. デプロイ確認

1. 「ビルド」タブで進行状況を確認
2. デプロイ完了後、「プレビューのURL」でアクセス可能

## デプロイ後の確認

1. ポートフォリオページを開く
2. パスワード入力画面が表示されることを確認
3. パスワードを入力してアクセス
4. ポートフォリオコンテンツが表示されることを確認

## カスタムドメイン設定

1. Cloudflareダッシュボードで該当プロジェクトを開く
2. 「カスタムドメイン」タブをクリック
3. ドメインを入力して追加
4. DNSレコードを確認・更新

## パスワード変更

### Cloudflareダッシュボードから

1. Pages プロジェクトを開く
2. 「設定」→「環境変数」
3. `PORTFOLIO_PASSWORD` を編集
4. 変更を保存

変更は即座に反映されます（キャッシュによって数秒の遅延がある場合があります）。

### コードで変更する場合

1. `wrangler.toml` の `PORTFOLIO_PASSWORD` を編集
2. GitHubにプッシュ
3. Cloudflareが自動デプロイ

> ⚠️ **セキュリティ警告**: `wrangler.toml` にパスワードを記述する場合、コードが公開リポジトリにプッシュされるため注意してください。本番環境では Cloudflare ダッシュボードで設定することを推奨します。

## 自動デプロイ

このセットアップでは、以下の動作が自動化されます：

- ✅ GitHubの `main` ブランチに変更がプッシュされる
- ✅ Cloudflare Pages が自動的に検出
- ✅ ビルドが実行される
- ✅ 成功時は自動デプロイ

## トラブルシューティング

### デプロイが失敗する

1. **ビルドログの確認**
   - Cloudflareダッシュボードの「ビルド」タブで確認
   - エラーメッセージを読む

2. **ファイル構成の確認**
   ```
   /
   ├── index.html
   ├── css/
   │   └── style.css
   ├── js/
   │   └── auth.js
   └── functions/
       └── api/
           └── auth.js
   ```

3. **環境変数の確認**
   - `PORTFOLIO_PASSWORD` が設定されているか確認

### パスワード認証がうまくいかない

1. **ブラウザコンソルをチェック（F12）**
   - JavaScriptエラーを確認
   - ネットワークタブでAPIレスポンスを確認

2. **環境変数の確認**
   - Cloudflareダッシュボードで `PORTFOLIO_PASSWORD` を確認
   - 空白でないか、スペースが含まれていないか確認

3. **キャッシュクリア**
   - Ctrl+Shift+Delete でキャッシュをクリア
   - または、ブラウザのシークレットモードで試す

### 静的ファイルが読み込まれない

1. パスの確認
   - `css/style.css` が正しくアップロードされているか確認
   - `js/auth.js` が正しくアップロードされているか確認

2. Cloudflareでのファイル確認
   - 開発者ツール（F12）のNetworkタブで確認
   - 404エラーが出ていないか確認

## Pages Functions について

このプロジェクトは **Cloudflare Pages Functions** を使用しています：

- `/functions/api/auth.js` - 認証API
- リクエストルーティングは自動的に処理されます
- `/api/auth` に POSTリクエストが来ると自動的に実行されます

詳しくは [SECURITY.md](SECURITY.md) を参照してください。

## 高度な設定

### ビルドフックの使用

デプロイ前に特定の処理を実行したい場合：

1. Cloudflareダッシュボード→ビルド設定
2. 「ビルドフック」を設定
3. カスタムコマンドを実行

### キャッシュ制御

Cloudflareではデフォルトで静的ファイルがキャッシュされます：

```
# Cloudflare Pages キャッシュ設定
API レスポンス: キャッシュなし
静的ファイル: キャッシュあり（30日間）
```

キャッシュをクリアしたい場合：
1. ダッシュボーム → 「キャッシュをクリア」
2. 「すべてクリア」を選択

## まとめ

| 項目 | 説明 |
|------|------|
| 🔒 **セキュリティ** | サーバー側認証でパスワード露出なし |
| 🚀 **デプロイ** | GitHubプッシュで自動デプロイ |
| ⚙️ **設定** | 環境変数でパスワード管理 |
| 💾 **保存** | Cloudflareで完全に管理 |

質問や問題があれば、GitHubのissueを作成してください！
