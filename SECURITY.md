# セキュリティ実装ガイド

## 実装されているセキュリティ対策

### 1. ✅ サーバー側パスワード検証
- **クライアント側にパスワードが露出しない**
- Cloudflare Pages Functions で認証APIを実装
- パスワードは環境変数で管理（コード内に記述されない）

### 2. ✅ 環境変数による安全な設定
- `wrangler.toml` に `PORTFOLIO_PASSWORD` を設定
- 本番環境と開発環境で異なるパスワードを使用可能
- デプロイ時にCloudflareダッシュボードで変更可能

### 3. ✅ トークンベース認証
- 認証後、24時間有効なトークンを発行
- セッションストレージに保存（ブラウザ再起動で失効）
- トークンの有効期限を自動チェック

### 4. ✅ CORS対応
- `OPTIONS`リクエストに対応
- クロスオリジンからのアクセス許可設定

### 5. ✅ エラーハンドリング
- JSONでのエラーレスポンス
- 具体的なエラーメッセージで攻撃を防止

## Cloudflare Pages でのパスワード設定

### デプロイ手順

1. **GitHubにプッシュ**
```bash
git add .
git commit -m "Implement secure authentication with Pages Functions"
git push origin main
```

2. **Cloudflare ダッシュボード設定**
   - Pages プロジェクト内で「設定」を開く
   - 「環境変数」を選択
   - 以下を追加：
     - **変数名**: `PORTFOLIO_PASSWORD`
     - **値**: あなたのパスワード

### 環境別設定（本番環境のみ）

本番環境(Production)用に異なるパスワードを設定：
1. 「設定」→「環境変数」
2. 「Production」タブを選択
3. `PORTFOLIO_PASSWORD` を本番用パスワードに設定

## API エンドポイント

### POST `/api/auth`

**リクエスト**
```json
{
  "password": "your-password"
}
```

**レスポンス（成功時）**
```json
{
  "success": true,
  "token": "eyJ...",
  "message": "ログインに成功しました"
}
```

**レスポンス（失敗時）**
```json
{
  "success": false,
  "error": "パスワードが間違っています"
}
```

## ローカルテスト

```bash
# wranglerをインストール
npm install -g @cloudflare/wrangler

# ローカルで実行（環境変数を指定）
wrangler pages dev --env development
```

## セキュリティベストプラクティス

### ✅ 実装済み
- [x] パスワードをサーバー側で検証
- [x] 環境変数での設定管理
- [x] トークンベース認証
- [x] CORS対応
- [x] エラーハンドリング

### 🔄 今後の改善案
- [ ] レート制限（ブルートフォース対策）
- [ ] ログイン試行回数の追跡
- [ ] IPアドレスに基づく制限
- [ ] 監査ログの記録
- [ ] JWT署名による改ざん防止
- [ ] HTTPS強制

## よくある質問

**Q: パスワード変更後、いつから有効になる？**
A: Cloudflareに設定を保存した直後から有効です（キャッシュによっては数秒の遅延がある場合があります）

**Q: 複数のパスワードは対応している？**
A: 現在は単一のパスワードのみ対応しています。複数パスワード対応が必要な場合は、API側で修正が必要です。

**Q: パスワードをブラウザに記憶させたくない**
A: JavaScriptで `autocomplete="off"` を設定しているため、ブラウザのオートコンプリートは無効です。

## 脆弱性報告

セキュリティ問題を発見した場合は、公開する前にお知らせください。
